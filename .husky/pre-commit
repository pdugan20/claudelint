echo "Running pre-commit checks..."
echo ""

# 1. Lint-staged (ESLint + Prettier + Markdownlint on staged files only)
echo "1/10 Running lint-staged (linting and formatting staged files)..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "Lint-staged failed. Please fix the errors and try again."
  exit 1
fi
echo ""

# 2. Check for emojis (strict - only in headings)
echo "2/10 Checking for emojis..."
npm run check:emojis
if [ $? -ne 0 ]; then
  echo "Emojis found in code. Please remove them before committing."
  exit 1
fi
echo ""

# 3. Check logger spacing/formatting standards (CLI)
echo "3/10 Checking logger spacing..."
npm run check:logger-spacing
if [ $? -ne 0 ]; then
  echo "Logger spacing violations found. Please fix them."
  exit 1
fi
echo ""

# 4. Check logger usage in scripts
echo "4/10 Checking logger usage in scripts..."
npm run check:logger-usage
if [ $? -ne 0 ]; then
  echo "Logger usage violations found. Please fix them."
  exit 1
fi
echo ""

# 5. Verify rule implementations exist
echo "5/10 Verifying rule implementations..."
npm run verify:rule-implementations
if [ $? -ne 0 ]; then
  echo "Rule implementation check failed."
  exit 1
fi
echo ""

# 6. Check rule test coverage
echo "6/10 Checking rule coverage..."
npm run check:rule-coverage
if [ $? -ne 0 ]; then
  echo "Rule coverage check failed."
  exit 1
fi
echo ""

# 7. Check schema sync (Zod vs JSON Schema)
echo "7/10 Checking schema sync..."
npm run check:schema-sync
if [ $? -ne 0 ]; then
  echo "Schema sync check failed."
  exit 1
fi
echo ""

# 8. Build project (verify TypeScript compiles)
echo "8/10 Building project..."
npm run build
if [ $? -ne 0 ]; then
  echo "Build failed. Please fix TypeScript errors before committing."
  exit 1
fi
echo ""

# 9. Run validator tests
echo "9/10 Running validator tests..."
npx jest tests/validators --passWithNoTests
if [ $? -ne 0 ]; then
  echo "Validator tests failed."
  exit 1
fi
echo ""

# 10. Lint all markdown files
echo "10/10 Linting all markdown files..."
npm run lint:md
if [ $? -ne 0 ]; then
  echo "Markdownlint failed. Run 'npm run lint:md:fix' to auto-fix."
  exit 1
fi
echo ""

echo "âœ“ All pre-commit checks passed!"
exit 0
